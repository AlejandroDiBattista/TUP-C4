<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <title>Inventario: 50694</title>
    <style>
      body {
        font-family: 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #e0e0e0;
      }

      #app-root {
        max-width: 1200px;
        margin: 30px auto;
      }

      .flex {
        display: flex;
      }

      .column {
        flex-direction: column;
      }

      .row {
        flex-direction: row;
      }

      .center {
        justify-content: center;
        align-items: center;
      }

      .ellipsis {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .full-width {
        width: 100%;
      }

      h1 {
        font-size: 24px;
        margin-right: 15px;
      }

      .product-card {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        margin-bottom: 25px;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: 420px;
        width: 100%;
        overflow: hidden;
      }

      .pointer {
        cursor: pointer;
      }

      .quantity-display {
        font-size: 30px;
        color: rgba(1, 25, 243, 0.945);
        margin: 0px 15px 0px 20px;
        flex-shrink: 0;
        max-width: 30%;
        text-align: center;
        font-weight: bold;
      }

      .details-section {
        flex-grow: 1;
        min-width: 0;
      }

      .product-name {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .product-code {
        color: #666;
      }

      .button-edit,
      .button-delete,
      .button-add {
        background: none;
        border: none;
        cursor: pointer;
        padding: 7px;
        margin: 3px 0;
      }

      .button-edit i,
      .button-delete i,
      .button-add i {
        font-size: 22px;
        color: #333;
        cursor: pointer;
      }

      .button-confirm,
      .button-cancel {
        margin-bottom: 10px;
        background-color: transparent;
        padding: 6px;
        border: 1px solid #333;
        border-radius: 10px;
        box-sizing: border-box;
        outline: none;
        cursor: pointer;
      }

      input {
        margin-bottom: 7px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-sizing: border-box;
        outline: none;
        width: 90%;
      }

      input:last-child{
        margin-bottom: 0px;
      }
      
      input:focus {
        border-color: #888;
      }

      @media screen and (max-width: 768px) {
        .product-card {
          max-width: 85%;
        }
      }

    </style>
  </head>

  <body>
    <div id="app-root"></div>

    <script type="text/babel">
      const { createRoot } = ReactDOM;
      const { useState } = React;

      const MainApp = () => {
        return (
          <main className="flex center full-width">
            <Inventory />
          </main>
        );
      };

      const Inventory = () => {
        const [editingProductIds, setEditingProductIds] = useState([]);
        const [products, setProducts] = useState([
          { id: 1, name: "7up", code: "7799876543210", quantity: 31 },
        ]);

        const addProduct = () => {
          const id = products.length > 0
              ? Math.max(...products.map((product) => product.id)) + 1
              : 1;

          const newProduct = {
            id,
            name: "",
            code: "",
            quantity: 0,
          };

          setProducts([...products, newProduct]);
          setEditingProductIds([...editingProductIds, id]);
        };

        const editProduct = (e, id) => {
          e.stopPropagation();
          setEditingProductIds([...editingProductIds, id]);
        };

        const deleteProduct = (e, id) => {
          e.stopPropagation();
          setProducts(products.filter((product) => product.id !== id));
        };

        const saveProduct = (product) => {
          setProducts(products.map((p) => (p.id === product.id ? product : p)));
          setEditingProductIds(editingProductIds.filter((productId) => productId !== product.id));
        };

        const cancelEdit = (id) => {
          const existingProduct = products.find((prod) => prod.id === id);

          if (
            existingProduct &&
            existingProduct.name === "" &&
            existingProduct.code === "" &&
            existingProduct.quantity === 0
          ) {
            setProducts(products.filter((product) => product.id !== id));
          }

          setEditingProductIds(editingProductIds.filter((productId) => productId !== id));
        };

        const incrementQuantity = (productId) => {
          setProducts(products.map((p) => p.id === productId ? { ...p, quantity: p.quantity + 1 } : p));
        };

        products.sort((a, b) => a.name.localeCompare(b.name));

        return (
          <section className="flex column center full-width">
            <div className="flex row center">
              <h1>Inventario de Productos</h1>
              <button className="button-add" onClick={addProduct}>
                <i className="fa-regular fa-square-plus" />
              </button>
            </div>

            {products.map((product) => (
              <ProductCard
                key={product.id}
                product={product}
                isEditing={editingProductIds.includes(product.id)}
                editProduct={(e) => editProduct(e, product.id)}
                deleteProduct={(e) => deleteProduct(e, product.id)}
                saveProduct={saveProduct}
                cancelEdit={() => cancelEdit(product.id)}
                incrementQuantity={() => incrementQuantity(product.id)}
              />
            ))}
          </section>
        );
      };

      const ProductForm = ({ product, saveProduct, cancelEdit }) => {
        const [name, setName] = useState(product.name);
        const [code, setCode] = useState(product.code);
        const [quantity, setQuantity] = useState(product.quantity);
        const isSubmitDisabled = name?.trim().length === 0 || code?.trim().length < 13 || quantity > 100;

        const handleSubmit = (e) => {
          e.preventDefault();
          if (quantity <= 100) {
            saveProduct({ ...product, name, code, quantity });
          }
        };

        const handleCodeChange = (e) => {
          const value = e.target.value.replace(/\D/g, "");
          setCode(value);
        };

        return (
          <form onSubmit={handleSubmit} className="product-card">
            <div className="flex column full-width">
              <input
                type="text"
                name="name"
                placeholder="Nombre"
                value={name}
                onChange={(e) => setName(e.target.value)}
                required
              />
              <input
                type="text"
                minLength={13}
                maxLength={13}
                name="code"
                placeholder="Codigo EAN (13 digitos)"
                value={code}
                onChange={handleCodeChange}
                required
              />
              <input
                type="number"
                name="quantity"
                placeholder="Cantidad"
                min={0}
                max={100}
                value={quantity}
                onChange={(e) => setQuantity(Number(e.target.value))}
                required
              />
            </div>
            <div className="flex column">
              <button
                className="button-confirm"
                type="submit"
                disabled={isSubmitDisabled}
              >
                Guardar
              </button>
              <button className="button-cancel" onClick={cancelEdit}>
                Cancelar
              </button>
            </div>
          </form>
        );
      };

      const ProductCard = ({ product, isEditing, editProduct, deleteProduct, saveProduct, cancelEdit, incrementQuantity }) => {
        const { quantity, name, code } = product;
        return isEditing ? (
          <ProductForm
            product={product}
            saveProduct={saveProduct}
            cancelEdit={cancelEdit}
          />
        ) : (
          <article className="product-card pointer" onClick={incrementQuantity}>
            <div className="quantity-display ellipsis">{quantity}</div>
            <div className="details-section">
              <div className="product-name ellipsis">{name}</div>
              <div className="product-code ellipsis">{code}</div>
            </div>
            <div className="flex column center">
              <button className="button-edit" onClick={editProduct}>
                <i className="fa-regular fa-pen-to-square"></i>
              </button>
              <button className="button-delete" onClick={deleteProduct}>
                <i className="fa-regular fa-trash-can"></i>
              </button>
            </div>
          </article>
        );
      };

      const root = createRoot(document.getElementById("app-root"));
      root.render(<MainApp />);
    </script>
  </body>
</html>
