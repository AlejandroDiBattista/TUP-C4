<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- Enlaces a React, ReactDOM y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!--Bootstrap stylesheet-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>Control de Stock - 59265</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .container {
            margin-top: 10vh;
            width: 600px;
            background-color: white;
            border-radius: 7px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
        }

        .titulo-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .titulo {
            font-weight: 700;
        }

        .btn-agregar {
            border-radius: 10px;
            background-color: transparent;
            border: 3px solid black;
            padding: 0.5rem;
            transition: 0.5s;
        }

        .btn-agregar:hover {
            transform: scale(1.15);
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 2rem;
            display: flex;
            padding: 1rem;
        }

        .fa-solid {
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.5s;
        }

        .fa-solid:hover {
            transform: scale(1.15);
        }

        .cant-producto {
            font-size: 4rem;
            color: blue;
            margin-left: 10px;
        }

        .form-agregar,
        .editar-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 1rem;
        }

        input.form-control {
            margin-bottom: 5%;
        }

        .editar-form {
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
            align-items: center;
            justify-content: space-between;
        }

        .editar-form .form-btns {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect } = React;

        const productosIniciales = [
            {
                id: 1,
                nombre: "7up",
                codigoEAN: "7799876543210",
                cantidad: 7
            },
            {
                id: 2,
                nombre: "Coca Cola",
                codigoEAN: "7889876577610",
                cantidad: 67
            },
            {
                id: 3,
                nombre: "Fanta",
                codigoEAN: "8879676543574",
                cantidad: 30
            },
            {
                id: 4,
                nombre: "Pepsi",
                codigoEAN: "4399877743368",
                cantidad: 6
            },
            {
                id: 5,
                nombre: "Sprite",
                codigoEAN: "6398844443347",
                cantidad: 4
            }
        ];



        const CardProducto = ({ producto, incrementar, setIdEditando, setProductoEditando, eliminarProducto }) => {

            const editarProducto = (e) => {
                e.stopPropagation();
                setIdEditando(producto.id);
                setProductoEditando(producto);
            }

            const eliminar = (e) => {
                e.stopPropagation();
                eliminarProducto(producto.id);
            }

            return (
                <div className="card d-flex flex-row" onClick={() => incrementar(producto.id)}>
                    <div className="producto d-flex align-items-center">
                        <span className="cant-producto">{producto.cantidad}</span>
                        <div className="info-producto ps-4 mt-2">
                            <h3 className="producto-nombre fw-bold fs-3">{producto.nombre}</h3>
                            <p className="producto-ean fs-5">{producto.codigoEAN}</p>
                        </div>
                    </div>
                    <div className="d-flex flex-column justify-content-around">
                        <i className="fa-solid fa-pen-to-square mb-3" style={{ color: "#3264c8" }} onClick={editarProducto}></i>
                        <i className="fa-solid fa-trash-can" style={{ color: "#bd2828" }} onClick={eliminar}></i>
                    </div>
                </div>
            );
        }
        const obtenerProductos = () => {
            const productosLocales = localStorage.getItem("productos");
            return productosLocales ? JSON.parse(productosLocales) : productosIniciales;
        }
        const EditarProducto = ({ idEditando, setIdEditando, productoEditando, setProductoEditando, setProductos, productos }) => {
            const handleCampo = (e) => {
                const { name, value } = e.target;
                setProductoEditando(producto => ({ ...producto, [name]: value }));
            }

            const guardarProducto = (e) => {
                e.preventDefault();
                const productosActualizados = productos.map((producto) =>
                    producto.id === idEditando ? { ...productoEditando, cantidad: parseInt(productoEditando.cantidad) } : producto
                );
                setProductos(productosActualizados);
                setIdEditando(null);
            }

            return (
                <form className="editar-form p-3" onSubmit={guardarProducto}>
                    <input
                        type="text"
                        name="nombre"
                        placeholder="Nombre"
                        className="form-control"
                        value={productoEditando.nombre}
                        onChange={handleCampo}
                    />
                    <input
                        type="text"
                        name="codigoEAN"
                        placeholder="Código EAN"
                        className="form-control"
                        value={productoEditando.codigoEAN}
                        onChange={handleCampo}
                    />
                    <input
                        type="number"
                        name="cantidad"
                        placeholder="Cantidad"
                        className="form-control"
                        value={productoEditando.cantidad}
                        onChange={handleCampo}
                    />
                    <div className="form-btns">
                        <button type="submit" className="btn btn-primary mb-1">Modificar</button>
                        <button type="button" className="btn btn-secondary" onClick={() => setIdEditando(null)}>Cancelar</button>
                    </div>
                </form>
            );
        }

        const AgregarProducto = ({ cancelarAgregar,setMostrarFormAgregar, setProductos, productos }) => {
            const [nuevo, setNuevo] = useState({ id: "", nombre: "", codigoEAN: "", cantidad: "" });

            const handleCampo = (e) => {
                const { name, value } = e.target;
                setNuevo({ ...nuevo, [name]: value });
            };

            const ultimoId = () => {
                return productos[productos.length - 1].id
            }

            const agregarProductoNuevo = (e) => {
                e.preventDefault();
                if (nuevo.nombre && nuevo.codigoEAN && nuevo.cantidad) {
                    setProductos(productosAnterior => {
                        return [...productosAnterior, { ...nuevo, cantidad: parseInt(nuevo.cantidad), id: ultimoId() + 1 }];
                    });
                    setNuevo({ id: "", nombre: "", codigoEAN: "", cantidad: "" });
                    setMostrarFormAgregar(false);
                } else {
                    alert("Completar todos los campos");
                }
            }

            return (
                <form className="form-agregar" onSubmit={agregarProductoNuevo}>
                    <label className="form-label fs-5 fw-medium">Nombre del producto </label>
                    <input
                        type="text"
                        name="nombre"
                        className="form-control"
                        value={nuevo.nombre}
                        onChange={handleCampo}
                    />
                    <label className="form-label fs-5 fw-medium">Código EAN</label>
                    <input
                        type="text"
                        name="codigoEAN"
                        className="form-control"
                        value={nuevo.codigoEAN}
                        onChange={handleCampo}
                    />
                    <label className="form-label fs-5 fw-medium">Cantidad</label>
                    <input
                        type="number"
                        name="cantidad"
                        className="form-control"
                        value={nuevo.cantidad}
                        onChange={handleCampo}
                    />
                    <div className="form-btns text-center mb-5">
                        <button type="submit" className="btn btn-success me-4">Agregar</button>
                        <button type="button" className="btn btn-secondary" onClick={cancelarAgregar}>Cancelar</button>
                    </div>
                </form>
            );
        }

        const Producto = ({ productos, setProductos, productoEditando, setProductoEditando, idEditando, setIdEditando }) => {

            const incrementar = (id) => {
                const productosActualizados = productos.map((producto) =>
                    producto.id === id ? { ...producto, cantidad: parseInt(producto.cantidad) + 1 } : producto
                );
                setProductos(productosActualizados);
            }

            const eliminarProducto = (id) => {
                const productosActualizados = productos.filter((producto) => producto.id !== id);
                setProductos(productosActualizados);
            }

            return (
                <div className="productos">
                    {productos.sort((a, b) => a.nombre.localeCompare(b.nombre)).map((producto) => (
                        idEditando !== producto.id ? (
                            <CardProducto
                                key={producto.id}
                                producto={producto}
                                setProductoEditando={setProductoEditando}
                                setIdEditando={setIdEditando}
                                eliminarProducto={eliminarProducto}
                                incrementar={incrementar}
                            />
                        ) : (
                            <EditarProducto
                                key={producto.id}
                                idEditando={idEditando}
                                setIdEditando={setIdEditando}
                                productoEditando={productoEditando}
                                setProductoEditando={setProductoEditando}
                                setProductos={setProductos}
                                productos={productos}
                            />
                        )
                    ))}
                </div>
            );
        }

        const App = () => {
            const [mostrarFormAgregar, setMostrarFormAgregar] = useState(false);
            const [productos, setProductos] = useState(obtenerProductos);
            
            const [idEditando, setIdEditando] = useState(null);
            const [productoEditando, setProductoEditando] = useState({ id: "", nombre: "", codigoEAN: "", cantidad: "" });

            useEffect(() => {
                localStorage.setItem("productos", JSON.stringify(productos));
            }, [productos]);

            const handleAgregar = () => {
                setMostrarFormAgregar(true);
            }
            const cancelarAgregar = () => {
                setMostrarFormAgregar(false);
            }
            return (
                <div className="container p-5">
                    <div className="titulo-container">
                        <h1 className="titulo mb-5">Control Depósito</h1>
                        <button className="btn-agregar" onClick={handleAgregar}>
                            <i className="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    {mostrarFormAgregar && (
                        <AgregarProducto
                            cancelarAgregar={cancelarAgregar}
                            setMostrarFormAgregar={handleAgregar}
                            setProductos={setProductos}
                            productos={productos}
                        />
                    )}
                    <Producto
                        productos={productos}
                        setProductos={setProductos}
                        idEditando={idEditando}
                        setIdEditando={setIdEditando}
                        productoEditando={productoEditando}
                        setProductoEditando={setProductoEditando}
                    />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>

</html>