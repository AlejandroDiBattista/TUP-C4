<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 
        nota: 10
        observacion:
        - Pequeñas diferencias con el diseño original, pero cumple con los requerimientos.
    -->
    <title>Control de Depósito</title>
    <!-- Incluir React y React DOM -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Incluir Babel para compilar JSX en JavaScript -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        .form-group {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .button {
            background: none;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .StyleButton {
            border: 1px solid #000;
            padding: 3px;
        }

        .input-error {
            border: 1px solid red;
        }

        .form-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            /* Alineación vertical */
        }

        .form-inline {
            flex: 1;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .product-list {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            width: 320px;
            margin: 20px auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* Sombra suave alrededor de la card */

        }

        .card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            width: 320px;
            margin: 20px auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* Sombra suave alrededor de la card */

        }

        .input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-actions {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .fuenteStock {
            font-size: 50px;
            color: blue;
        }

        .estiloAgregar {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        // Componente de React para la tarjeta de Control de Depósito
        const DepositControlCard = () => {
            // Estado local para almacenar los productos
            const [products, setProducts] = React.useState([
                { productName: "coca", eanCode: 3333333333333, stock: 2 },
            ]);
            // Estado local para los campos del formulario
            const [productName, setProductName] = React.useState("");
            const [eanCode, setEanCode] = React.useState("");
            const [stock, setStock] = React.useState("");
            // Estado local para manejar errores de validación
            const [inputErrors, setInputErrors] = React.useState({
                productName: false,
                eanCode: false,
                stock: false,
            });
            // Estado local para almacenar los productos seleccionados para editar
            const [selectedProducts, setSelectedProducts] = React.useState([]);
            // Estado local para controlar la visualización del formulario de agregar
            const [showForm, setShowForm] = React.useState(false);

            // Función para manejar la edición de un producto
            const handleEditProduct = (index) => {
                setSelectedProducts((prevSelectedProducts) =>
                    prevSelectedProducts.includes(index)
                        ? prevSelectedProducts
                        : [...prevSelectedProducts, index]
                );
            };

            // Función para manejar la cancelación de la edición de un producto
            const handleCancelEdit = (index) => {
                setSelectedProducts((prevSelectedProducts) =>
                    prevSelectedProducts.filter((i) => i !== index)
                );
            };

            // Función para manejar la eliminación de un producto
            const handleDeleteProduct = (index) => {
                const updatedProducts = [...products];
                updatedProducts.splice(index, 1);
                setProducts(updatedProducts);
            };

            // Función para mostrar el formulario de agregar producto
            const showAddForm = () => {
                setShowForm(true);
                setProductName("");
                setEanCode("");
                setStock("");
                setInputErrors({
                    productName: false,
                    eanCode: false,
                    stock: false,
                });
            };

            // Función para ocultar el formulario de agregar producto
            const hideForm = () => {
                setShowForm(false);
                setProductName("");
                setEanCode("");
                setStock("");
                setInputErrors({
                    productName: false,
                    eanCode: false,
                    stock: false,
                });
            };

            // Función para manejar el envío del formulario
            const handleAddProduct = () => {
                // Validar los campos antes de agregar el producto
                let hasError = false;
                const errors = {
                    productName: false,
                    eanCode: false,
                    stock: false,
                };

                // Validar nombre del producto (no vacío)
                if (productName.trim() === "") {
                    alert("Ingrese un nombre válido.");
                    errors.productName = true;
                    hasError = true;
                }

                // Validar código EAN (exactamente 13 dígitos numéricos)
                if (!/^\d{13}$/.test(eanCode)) {
                    alert("Ingrese un código EAN válido.");
                    errors.eanCode = true;
                    hasError = true;
                } else if (products.some((product) => product.eanCode === eanCode)) {
                    alert("El código EAN ingresado ya existe.");
                    errors.eanCode = true;
                    hasError = true;
                }

                // Validar stock (debe ser un número mayor a cero y menor o igual a 100)
                const stockNumber = Number(stock);
                if (isNaN(stockNumber) || stockNumber <= 0 || stockNumber > 100) {
                    alert(
                        "Ingrese una cantidad válida (mayor a cero y menor o igual a 100)."
                    );
                    errors.stock = true;
                    hasError = true;
                }

                // Mostrar errores si los hay
                if (hasError) {
                    setInputErrors(errors);
                    return;
                }

                // Crear el nuevo producto
                const newProduct = {
                    productName: productName,
                    eanCode: eanCode,
                    stock: stockNumber,
                };

                setProducts((prevProducts) => {
                    const updatedProducts = [...prevProducts, newProduct];
                    updatedProducts.sort((a, b) =>
                        a.productName.localeCompare(b.productName)
                    );
                    return updatedProducts;
                });

                // Ocultar formulario después de agregar
                hideForm();
            };

            // Función para manejar el envío del formulario de edición
            const handleSaveEdit = (index, updatedProduct) => {
                setProducts((prevProducts) => {
                    const updatedProducts = [...prevProducts];
                    updatedProducts[index] = updatedProduct;
                    updatedProducts.sort((a, b) =>
                        a.productName.localeCompare(b.productName)
                    );
                    return updatedProducts;
                });
                handleCancelEdit(index);
            };

            // Función para incrementar el stock al hacer clic en la tarjeta del producto
            const handleIncrementStock = (index) => {
                setProducts((prevProducts) => {
                    const updatedProducts = [...prevProducts];
                    updatedProducts[index].stock += 1;
                    return updatedProducts;
                });
            };

            return (
                <div>
                    <div className="estiloAgregar">
                        <h2>Control de Depósito</h2>
                        <button className="button" onClick={showAddForm}>
                            <i className="fa-regular fa-square-plus" />
                        </button>
                    </div>

                    {!showForm && <div className="button-group"></div>}
                    {showForm && (
                        <div className="card">
                            <div className="form-group">
                                <div class="input-container">
                                    <input
                                        placeholder="Nombre"
                                        type="text"
                                        id="productName"
                                        value={productName}
                                        onChange={(e) => setProductName(e.target.value)}
                                        className={inputErrors.productName ? "input-error" : ""}
                                    />
                                    <input
                                        placeholder="Código EAN"
                                        type="text"
                                        id="eanCode"
                                        value={eanCode}
                                        onChange={(e) => {
                                            if (e.target.value.length <= 13) {
                                                setEanCode(e.target.value);
                                            }
                                        }}
                                        className={inputErrors.eanCode ? "input-error" : ""}
                                    />
                                    <input
                                        placeholder="Stock"
                                        type="number"
                                        id="stock"
                                        value={stock}
                                        onChange={(e) => setStock(e.target.value)}
                                        className={inputErrors.stock ? "input-error" : ""}
                                    />
                                </div>
                            </div>

                            <div className="button-group">
                                <button
                                    className="button StyleButton"
                                    onClick={handleAddProduct}
                                >
                                    Agregar
                                </button>
                                <button className="button StyleButton" onClick={hideForm}>
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="product-list">
                        {products.map((product, index) => (
                            <div
                                key={index}
                                className="product-card"
                                onClick={() => handleIncrementStock(index)}
                            >
                                {selectedProducts.includes(index) ? (
                                    <div className="form-group">
                                        <div class="input-container">
                                            <input
                                                type="text"
                                                value={product.productName}
                                                onChange={(e) =>
                                                    setProducts((prevProducts) => {
                                                        const updatedProducts = [...prevProducts];
                                                        updatedProducts[index].productName = e.target.value;
                                                        return updatedProducts;
                                                    })
                                                }
                                            />
                                            <input
                                                type="text"
                                                value={product.eanCode}
                                                onChange={(e) => {
                                                    if (e.target.value.length <= 13) {
                                                        setProducts((prevProducts) => {
                                                            const updatedProducts = [...prevProducts];
                                                            updatedProducts[index].eanCode = e.target.value;
                                                            return updatedProducts;
                                                        });
                                                    }
                                                }}
                                            />
                                            <input
                                                type="number"
                                                value={product.stock}
                                                onChange={(e) =>
                                                    setProducts((prevProducts) => {
                                                        const updatedProducts = [...prevProducts];
                                                        updatedProducts[index].stock = e.target.value;
                                                        return updatedProducts;
                                                    })
                                                }
                                            />
                                        </div>

                                        <div className="button-group">
                                            <button
                                                className="button StyleButton"
                                                onClick={() => handleSaveEdit(index, product)}
                                            >
                                                Aceptar
                                            </button>
                                            <button
                                                className="button StyleButton"
                                                onClick={() => handleCancelEdit(index)}
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <>
                                        <div className="fuenteStock">{product.stock}</div>
                                        <div>
                                            <div><h2><b>{product.productName}</b></h2></div>
                                            <div>{product.eanCode}</div>
                                        </div>

                                        <div className="product-actions">
                                            <button
                                                className="button"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    handleEditProduct(index);
                                                }}
                                            >
                                                <i className="fa-regular fa-pen-to-square" />
                                            </button>
                                            <button
                                                className="button"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    handleDeleteProduct(index);
                                                }}
                                            >
                                                <i className="fa-regular fa-trash-can" />
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Renderizar el componente en el DOM
        ReactDOM.render(<DepositControlCard />, document.getElementById("root"));
    </script>
</body>

</html>